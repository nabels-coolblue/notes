# Purpose

These notes describe the process of creating a monitor for the Proposal Generator for the team Restocking.

The monitor checks whether the Demand Forecast data has been refreshed in the past 28 hours. If it exceeds that number, its very likely that this will lead to an outage. Because the proposals that the Restocking Generator will provide to users will be faulty, since they're based on yesterday's data.

# Defining the team and monitor 

## Naming

Always name the monitor in such a manner as that it describes the positive scenario, e.g. Data is reliable rather than Forecast data is old.

This is meant to prevent double negation, which improves readability and hence reduces cognitive overhead.

## Repositories

Both repositories are based on HashiCorp's Terraform. Terraform provides a way to store your configuration in a declarative manner, and executes your scripts in an idempotent manner against the API of your choice. Terraform is used in the below repositories to instrument DataDog and PagerDuty.

## Datadog

- https://github.com/coolblue-development/datadog
  https://github.com/coolblue-development/datadog/blob/master/terraform/README.MD

The Datadog repository holds the definitions of our Datadog application monitors.

There is one directory per application. For our Proposal Generator the monitors can be found here:
- https://github.com/coolblue-development/datadog/tree/master/terraform/restocking-proposal-generator

Please note that the .tfstate file is generated by running Terraform (which happens as part of the build process). The other files:

- main.tf (the definitions of the monitors)
- terraform.tfvars (holds applcation name/owner, definitions of alert destination, e.g. Slack channel)
- vars.tf 

Are all created manually. 

## PagerDuty

- https://github.com/coolblue-development/pagerduty
  https://github.com/coolblue-development/pagerduty/blob/master/terraform/README.md

For now the PagerDuty repository is maintained by Matt. 

For the interested, this is how you would add us as a team to PagerDuty using the Terraform repository:

- https://github.com/coolblue-development/pagerduty/pull/21/files

# Integrations between DataDog and Slack / Pagerduty

The integrations between DataDog and Pagerduty / Slack have to be set up manually. 

- Slack integrations: https://app.datadoghq.com/account/settings#integrations/slack
- Pagerduty integrations: https://app.datadoghq.com/account/settings#integrations/pagerduty

# The result

https://app.datadoghq.com/monitors#2233365?group=all&live=4h
